import{_ as l,c as p,a as t,b as a,d as s,e as o,w as i,r as c,o as r}from"./app-pFFYG-xA.js";const d={};function u(h,n){const e=c("RouteLink");return r(),p("div",null,[n[8]||(n[8]=t(`<h1 id="caching-performance" tabindex="-1"><a class="header-anchor" href="#caching-performance"><span>Caching &amp; Performance</span></a></h1><p>Translation-heavy apps can grind to a halt if each lookup triggers a database query. This guide shows you how to keep translations fast—from eager loading to shared caches and performance tuning.</p><hr><h2 id="eager-loading-translations" tabindex="-1"><a class="header-anchor" href="#eager-loading-translations"><span>Eager loading translations</span></a></h2><p>Avoid N+1 queries by pre-fetching the locales you need:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token comment">// Single locale</span></span>
<span class="line"><span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">withTranslations</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;ckb&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Multiple locales</span></span>
<span class="line"><span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">withTranslations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;ckb&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;ar&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Every locale available</span></span>
<span class="line"><span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">withAllTranslations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Lazy eager load on an existing model</span></span>
<span class="line"><span class="token variable">$post</span> <span class="token operator">=</span> <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token variable">$post</span><span class="token operator">-&gt;</span><span class="token function">loadTranslations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;ckb&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;ar&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Each method hydrates the <code>translations</code> relationship and primes the in-memory cache so future calls to <code>translate()</code> or attribute access do not hit the database.</p><hr><h2 id="per-model-caching" tabindex="-1"><a class="header-anchor" href="#per-model-caching"><span>Per-model caching</span></a></h2><p>The trait maintains an in-memory cache for translations on each model instance:</p><ul><li>Accessing a translation populates the cache.</li><li>Subsequent reads during the same request are free.</li><li>Calling any mutation method (<code>setTranslation</code>, <code>setTranslations</code>, <code>setTranslationsBatch</code>, <code>deleteTranslation</code>, etc.) clears the cache automatically.</li></ul><hr><h2 id="shared-cache-stores" tabindex="-1"><a class="header-anchor" href="#shared-cache-stores"><span>Shared cache stores</span></a></h2><p>To persist translations across requests, configure a <code>TranslationCacheStore</code>. The package ships with two implementations:</p><ol><li><code>ArrayTranslationCacheStore</code> – in-memory, primarily for testing.</li><li><code>CacheTranslationCacheStore</code> – wraps any Laravel cache driver (Redis, Memcached, Dynamo, etc.).</li></ol><h3 id="configure-via-config-multi-lang-php" tabindex="-1"><a class="header-anchor" href="#configure-via-config-multi-lang-php"><span>Configure via <code>config/multi-lang.php</code></span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token string single-quoted-string">&#39;cache_store&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;driver&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;redis&#39;</span><span class="token punctuation">,</span>                 <span class="token comment">// null uses the default cache store</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;prefix&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;multi_lang:translations&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;ttl&#39;</span>    <span class="token operator">=&gt;</span> <span class="token number">3600</span><span class="token punctuation">,</span>                    <span class="token comment">// seconds; null = forever</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="configure-at-runtime" tabindex="-1"><a class="header-anchor" href="#configure-at-runtime"><span>Configure at runtime</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">setTranslationCacheStore</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CacheTranslationCacheStore</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;redis&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token argument-name">prefix</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">&#39;multi_lang:translations&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token argument-name">ttl</span><span class="token punctuation">:</span> <span class="token number">3600</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Reset to default (per-model cache only)</span></span>
<span class="line"><span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">resetTranslationCacheStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,19)),a("p",null,[n[1]||(n[1]=s("You can implement your own store by satisfying the ",-1)),n[2]||(n[2]=a("code",null,"TranslationCacheStore",-1)),n[3]||(n[3]=s(" interface (see ",-1)),o(e,{to:"/guide/extensibility.html"},{default:i(()=>[...n[0]||(n[0]=[s("Extensibility & Integrations",-1)])]),_:1}),n[4]||(n[4]=s(").",-1))]),n[9]||(n[9]=t('<hr><h2 id="priming-and-invalidation" tabindex="-1"><a class="header-anchor" href="#priming-and-invalidation"><span>Priming and invalidation</span></a></h2><ul><li><strong>Priming</strong>: call <code>$post-&gt;getTranslations(&#39;ckb&#39;)</code> after eager loading to ensure the payload is cached (helpful before queueing a job).</li><li><strong>Invalidation</strong>: all write operations clear per-model caches and call <code>forget()</code> on the external store if configured. You rarely need to flush caches manually, but <code>Post::resetTranslationCacheStore()</code> is handy in tests.</li></ul><hr><h2 id="performance-checklist" tabindex="-1"><a class="header-anchor" href="#performance-checklist"><span>Performance checklist</span></a></h2><ol><li><strong>Use eager loading</strong> whenever you render lists or tables of translated models.</li><li><strong>Index wisely</strong>: keep the built-in composite indexes (<code>translatable_type/translatable_id/locale/field</code> and <code>locale/field</code>) to maintain query speed.</li><li><strong>Batch updates</strong>: prefer <code>setTranslationsBatch()</code> to reduce database chatter during imports or admin workflows.</li><li><strong>Prune soft deletes</strong>: schedule a job to remove old soft-deleted rows if your table grows into the millions.</li><li><strong>Audit regularly</strong>: run <code>multi-lang:audit</code> in CI to catch missing translations before they reach production.</li><li><strong>Monitor the cache</strong>: use cache tags or metrics to confirm translations are hitting the shared store as expected.</li></ol><hr><h2 id="troubleshooting" tabindex="-1"><a class="header-anchor" href="#troubleshooting"><span>Troubleshooting</span></a></h2><table><thead><tr><th>Symptom</th><th>Likely cause</th><th>Quick fix</th></tr></thead><tbody><tr><td>Too many queries</td><td>Missing eager loading</td><td>Call <code>withTranslations()</code> or <code>loadTranslations()</code> for required locales.</td></tr><tr><td>Stale translations</td><td>Cache not invalidated</td><td>Ensure writes go through package helpers; call <code>resetTranslationCacheStore()</code> after custom import scripts.</td></tr><tr><td>Cache never hit</td><td>Shared store misconfigured</td><td>Confirm <code>config(&#39;multi-lang.cache_store&#39;)</code> is set correctly and the driver has permission.</td></tr><tr><td>Slow audit/export</td><td>Chunk size too large</td><td>Pass <code>--chunk=</code> to Artisan commands to balance memory and speed.</td></tr></tbody></table>',9)),a("p",null,[n[6]||(n[6]=s("With performance tuned, continue to ",-1)),o(e,{to:"/guide/automation.html"},{default:i(()=>[...n[5]||(n[5]=[s("Automation & CLI",-1)])]),_:1}),n[7]||(n[7]=s(" to automate audits, exports, and imports.",-1))])])}const m=l(d,[["render",u]]),k=JSON.parse('{"path":"/guide/caching-performance.html","title":"Caching & Performance","lang":"en-US","frontmatter":{"title":"Caching & Performance"},"git":{},"filePathRelative":"guide/caching-performance.md"}');export{m as comp,k as data};
