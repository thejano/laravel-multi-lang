import{_ as e,c as t,a as p,b as o,d as n,e as l,w as c,r as i,o as u}from"./app-_Y2zvlPS.js";const r={};function d(k,s){const a=i("RouteLink");return u(),t("div",null,[s[3]||(s[3]=p(`<h1 id="locale-middleware" tabindex="-1"><a class="header-anchor" href="#locale-middleware"><span>Locale Middleware</span></a></h1><p>Laravel Multi-Lang ships with a <code>SetLocale</code> middleware that detects a user’s preferred language and applies it before your controllers run. This page shows how to install it and what data sources it inspects.</p><hr><h2 id="what-the-middleware-does" tabindex="-1"><a class="header-anchor" href="#what-the-middleware-does"><span>What the middleware does</span></a></h2><p><code>TheJano\\MultiLang\\Middleware\\SetLocale</code> inspects each incoming request in the following order:</p><ol><li><strong>Route parameter</strong> – e.g. <code>/ckb/posts</code></li><li><strong>Query parameter</strong> – e.g. <code>/posts?locale=ar</code></li><li><strong>Session</strong> – value stored under <code>session(&#39;locale&#39;)</code></li><li><strong>Accept-Language header</strong> – standard HTTP mechanism</li></ol><p>The first match wins. Once a locale is set, Laravel Multi-Lang (and Laravel’s own translation system) use that locale for the remainder of the request.</p><hr><h2 id="installing-the-middleware" tabindex="-1"><a class="header-anchor" href="#installing-the-middleware"><span>Installing the middleware</span></a></h2><h3 id="laravel-11" tabindex="-1"><a class="header-anchor" href="#laravel-11"><span>Laravel 11+</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token comment">// bootstrap/app.php</span></span>
<span class="line"><span class="token operator">-&gt;</span><span class="token function">withMiddleware</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Middleware</span> <span class="token variable">$middleware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token variable">$middleware</span><span class="token operator">-&gt;</span><span class="token function">web</span><span class="token punctuation">(</span><span class="token argument-name">append</span><span class="token punctuation">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\\</span>TheJano<span class="token punctuation">\\</span>MultiLang<span class="token punctuation">\\</span>Middleware<span class="token punctuation">\\</span>SetLocale</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="laravel-≤10" tabindex="-1"><a class="header-anchor" href="#laravel-≤10"><span>Laravel ≤10</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token comment">// app/Http/Kernel.php</span></span>
<span class="line"><span class="token keyword">protected</span> <span class="token variable">$middlewareGroups</span> <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;web&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">        <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\\</span>TheJano<span class="token punctuation">\\</span>MultiLang<span class="token punctuation">\\</span>Middleware<span class="token punctuation">\\</span>SetLocale</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="route-parameter-driven-locales" tabindex="-1"><a class="header-anchor" href="#route-parameter-driven-locales"><span>Route parameter driven locales</span></a></h2><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Support<span class="token punctuation">\\</span>Facades<span class="token punctuation">\\</span>Route</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Http<span class="token punctuation">\\</span>Request</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\\</span>TheJano<span class="token punctuation">\\</span>MultiLang<span class="token punctuation">\\</span>Middleware<span class="token punctuation">\\</span>SetLocale</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/{locale}/posts&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$locale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// Locale already applied globally</span></span>
<span class="line">            <span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">withTranslations</span><span class="token punctuation">(</span><span class="token variable">$locale</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">latest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;posts.index&#39;</span><span class="token punctuation">,</span> <span class="token function">compact</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;posts&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;locale&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;locale&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;[a-zA-Z_-]+&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Visiting <code>/ckb/posts</code> sets the application locale to <code>ckb</code>. Any subsequent calls to <code>$post-&gt;title</code> or <code>trans_model($post, &#39;title&#39;)</code> automatically return Kurdish translations.</p><hr><h2 id="query-string-fallback" tabindex="-1"><a class="header-anchor" href="#query-string-fallback"><span>Query string fallback</span></a></h2><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/posts&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// /posts?locale=ar sets the locale for this request</span></span>
<span class="line">    <span class="token variable">$locale</span> <span class="token operator">=</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">withTranslations</span><span class="token punctuation">(</span><span class="token variable">$locale</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;posts.index&#39;</span><span class="token punctuation">,</span> <span class="token function">compact</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;posts&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;locale&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\\</span>TheJano<span class="token punctuation">\\</span>MultiLang<span class="token punctuation">\\</span>Middleware<span class="token punctuation">\\</span>SetLocale</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If the route doesn’t contain a locale segment, users can still switch languages by adding <code>?locale=...</code>. The middleware records the value in the session, so subsequent requests use the same locale automatically.</p><hr><h2 id="combining-with-sessions" tabindex="-1"><a class="header-anchor" href="#combining-with-sessions"><span>Combining with sessions</span></a></h2><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/locale&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;locale&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;locale&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;web&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After storing the user’s choice in the session, the middleware picks it up on the next request—even if the URL lacks a locale segment or query parameter.</p><hr><h2 id="tips" tabindex="-1"><a class="header-anchor" href="#tips"><span>Tips</span></a></h2><ul><li>Define a route constraint (<code>where(&#39;locale&#39;, &#39;[a-z]{2}&#39;)</code>) that matches the locales you support to avoid 404 noise.</li><li>Pair the middleware with the <code>supported_locales</code> setting in <code>config/app.php</code>—only values in that array should be accepted.</li><li>When building SPAs or APIs, expose the detected locale (<code>app()-&gt;getLocale()</code>) so your frontend knows which translation bundle to load.</li></ul>`,28)),o("p",null,[s[1]||(s[1]=n("With locale detection in place, continue to ",-1)),l(a,{to:"/guide/caching-performance.html"},{default:c(()=>[...s[0]||(s[0]=[n("Caching & Performance",-1)])]),_:1}),s[2]||(s[2]=n(" to make sure translated content stays fast.",-1))])])}const h=e(r,[["render",d]]),g=JSON.parse('{"path":"/guide/middleware.html","title":"Locale Middleware","lang":"en-US","frontmatter":{"title":"Locale Middleware"},"git":{"updatedTime":1762818033000,"contributors":[{"name":"Pshtiwan Mahmood","username":"","email":"kardoey@gmail.com","commits":1}],"changelog":[{"hash":"6f1865987fc5bf0bd26664c58f95973ad57c7533","time":1762818033000,"email":"kardoey@gmail.com","author":"Pshtiwan Mahmood","message":"2nd Version"}]},"filePathRelative":"guide/middleware.md"}');export{h as comp,g as data};
